<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.2, maximum-scale=2.0, viewport-fit=cover" />
    <title>Lékovka ULTIMATE 2026</title>
    <link rel="apple-touch-icon" href="https://api.iconify.design/lucide:pill.png?color=%238b8071&width=180">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://code.iconify.design/3/3.1.0/iconify.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root { 
            --bg: #f0ede9; --shadow-light: #ffffff; --shadow-dark: #d1ccc3; 
            --primary: #434343; --accent: #8b8071; --text: #4a4541;
        }
        .dark {
            --bg: #2d2a27; --shadow-light: #3a3632; --shadow-dark: #201e1b;
            --primary: #e8ece8; --accent: #b0a496; --text: #d6d2cd;
        }
        /* Celkové zvětšení textu */
        body { 
            background-color: var(--bg); 
            font-family: 'Quicksand', sans-serif; 
            color: var(--text); 
            min-height: 100vh; 
            transition: 0.3s; 
            -webkit-tap-highlight-color: transparent;
            font-size: 18px; /* Zvětšeno z původních 16px */
        }
        
        .neu-raised { background: var(--bg); box-shadow: 10px 10px 20px var(--shadow-dark), -10px -10px 20px var(--shadow-light); border-radius: 24px; border: 2px solid transparent; }
        .neu-inset { background: var(--bg); box-shadow: inset 8px 8px 16px var(--shadow-dark), inset -8px -8px 16px var(--shadow-light); border-radius: 16px; }
        
        /* Větší tlačítka pro S24 */
        .neu-btn { 
            background: var(--bg); 
            box-shadow: 8px 8px 16px var(--shadow-dark), -8px -8px 16px var(--shadow-light); 
            cursor: pointer; border: none; transition: 0.2s; border-radius: 16px; 
            display: flex; align-items: center; justify-content: center; 
            color: var(--text);
            min-height: 55px; /* Vyšší tlačítka pro snadný klik */
            font-size: 18px;
        }
        .neu-btn:active { box-shadow: inset 5px 5px 10px var(--shadow-dark), inset -5px -5px 10px var(--shadow-light); transform: scale(0.96); }
        
        .day-checkbox:checked + label, .time-checkbox:checked + label, .mode-radio:checked + label, .icon-radio:checked + label { 
            box-shadow: inset 5px 5px 10px var(--shadow-dark); 
            color: var(--primary); 
            font-weight: 800; 
            border: 2px solid var(--accent); 
        }

        /* Větší vstupy */
        input { 
            border: none; outline: none; background: transparent; width: 100%; 
            font-weight: 700; padding: 12px; color: var(--primary); 
            font-size: 20px !important; 
        }
        
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 12px; }
        .cal-day { aspect-ratio: 1/1; display: flex; align-items: center; justify-content: center; border-radius: 14px; font-weight: 700; font-size: 18px; }
        
        .hidden { display: none !important; }
        .taken-row { opacity: 0.3; text-decoration: line-through; }
        
        /* Nadpisy */
        h2 { font-size: 1.5rem !important; }
        h3 { font-size: 1.3rem !important; }
        label { font-size: 14px !important; letter-spacing: 0.05em; }
    </style>
</head>
<body class="p-4 md:p-8">

<div class="max-w-4xl mx-auto"> <div class="flex justify-between items-center mb-8">
        <button onclick="toggleDarkMode()" class="neu-btn w-16 h-16"><span class="iconify" id="dark-icon" data-icon="lucide:moon" data-width="30"></span></button>
        <div class="flex gap-4 flex-1 mx-4">
            <button onclick="switchTab('today')" id="tab-today" class="neu-btn flex-1 font-bold active gap-2"><span class="iconify" data-icon="lucide:pill" data-width="24"></span> DNES</button>
            <button onclick="switchTab('calendar')" id="tab-calendar" class="neu-btn flex-1 font-bold gap-2"><span class="iconify" data-icon="lucide:calendar-check" data-width="24"></span> HISTORIE</button>
        </div>
        <button onclick="requestNotif()" class="neu-btn w-16 h-16 text-blue-500"><span class="iconify" data-icon="lucide:bell" data-width="30"></span></button>
    </div>

    <div id="view-today">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">
            <div class="neu-raised p-6 text-center"><label class="uppercase font-black opacity-50 block mb-1">Zbývá dnes</label><span id="stat-rem" class="text-4xl font-black text-accent">0</span></div>
            <div class="neu-raised p-6 text-center"><label class="uppercase font-black opacity-50 block mb-1">Čas</label><span id="live-clock" class="text-4xl font-black text-slate-500">00:00</span></div>
            <button onclick="takeAllToday()" class="neu-btn bg-slate-700 text-white font-black uppercase text-sm tracking-widest">Vzít vše</button>
        </div>

        <div class="grid grid-cols-1 gap-10">
            <div id="form-container" class="neu-raised p-8">
                <h2 class="font-black mb-6 uppercase tracking-widest text-accent text-center">Nový lék</h2>
                
                <div class="flex justify-around mb-8 p-3 neu-inset">
                    <input type="radio" name="f-icon" id="i1" value="lucide:pill" checked class="icon-radio hidden"><label for="i1" class="neu-btn w-14 h-14"><span class="iconify" data-icon="lucide:pill" data-width="28"></span></label>
                    <input type="radio" name="f-icon" id="i2" value="lucide:droplets" class="icon-radio hidden"><label for="i2" class="neu-btn w-14 h-14"><span class="iconify" data-icon="lucide:droplets" data-width="28"></span></label>
                    <input type="radio" name="f-icon" id="i3" value="lucide:syringe" class="icon-radio hidden"><label for="i3" class="neu-btn w-14 h-14"><span class="iconify" data-icon="lucide:syringe" data-width="28"></span></label>
                    <input type="radio" name="f-icon" id="i4" value="lucide:thermometer" class="icon-radio hidden"><label for="i4" class="neu-btn w-14 h-14"><span class="iconify" data-icon="lucide:thermometer" data-width="28"></span></label>
                </div>

                <input type="hidden" id="f-id">
                <div class="space-y-6">
                    <div><label class="font-bold uppercase opacity-60 ml-2">Název léku</label><div class="neu-inset p-2"><input id="f-nazev" type="text" placeholder="např. Hořčík"></div></div>
                    
                    <div class="grid grid-cols-2 gap-6">
                        <div><label class="font-bold uppercase opacity-60 ml-2">Sklad (ks)</label><div class="neu-inset p-2"><input id="f-zasoba" type="number" step="0.5" value="0"></div></div>
                        <div><label class="font-bold uppercase opacity-60 ml-2">Dávka (ks)</label><div class="neu-inset p-2"><input id="f-davka" type="number" step="0.25" value="1"></div></div>
                    </div>

                    <div>
                        <label class="font-bold uppercase opacity-60 ml-2 block mb-2">Časy užívání</label>
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <input type="checkbox" id="t-0800" value="08:00" class="time-checkbox hidden"><label for="t-0800" class="neu-btn font-bold">08:00</label>
                            <input type="checkbox" id="t-1200" value="12:00" class="time-checkbox hidden"><label for="t-1200" class="neu-btn font-bold">12:00</label>
                            <input type="checkbox" id="t-1800" value="18:00" class="time-checkbox hidden"><label for="t-1800" class="neu-btn font-bold">18:00</label>
                            <input type="checkbox" id="t-2200" value="22:00" class="time-checkbox hidden"><label for="t-2200" class="neu-btn font-bold">22:00</label>
                        </div>
                        <div class="neu-inset p-2"><input id="f-custom-time" type="time" style="text-align: center;"></div>
                    </div>

                    <button onclick="saveMedicine()" class="neu-btn bg-slate-700 text-white w-full py-6 font-black uppercase tracking-widest">Uložit lék</button>
                    <button id="btn-cancel" onclick="resetForm()" class="hidden neu-btn w-full text-red-500 font-bold">Zrušit úpravy</button>
                </div>
            </div>

            <div class="space-y-8" id="plan-list"></div>
        </div>

        <div class="mt-16 neu-raised p-8 text-center">
            <h3 class="font-black text-sm uppercase opacity-40 mb-6">Správa aplikace</h3>
            <div class="grid grid-cols-1 gap-4">
                <button onclick="testNotification()" class="neu-btn text-blue-500 font-bold">VYZKOUŠET NOTIFIKACI</button>
                <div class="flex gap-4">
                    <button onclick="exportJSON()" class="neu-btn flex-1 text-sm">EXPORT</button>
                    <label class="neu-btn flex-1 text-sm cursor-pointer">IMPORT <input type="file" class="hidden" onchange="importJSON(event)"></label>
                </div>
            </div>
        </div>
    </div>

    <div id="view-calendar" class="hidden">
        <div class="neu-raised p-6">
            <div class="flex justify-between items-center mb-8">
                <button onclick="changeMonth(-1)" class="neu-btn w-14 h-14 font-bold text-2xl"><</button>
                <h2 id="month-label" class="font-black text-2xl uppercase">Měsíc 2026</h2>
                <button onclick="changeMonth(1)" class="neu-btn w-14 h-14 font-bold text-2xl">></button>
            </div>
            <div class="calendar-grid mb-4 text-xs font-black opacity-40 text-center uppercase">
                <div>Po</div><div>Út</div><div>St</div><div>Čt</div><div>Pá</div><div>So</div><div>Ne</div>
            </div>
            <div id="calendar-body" class="calendar-grid"></div>
            <div id="day-detail" class="neu-inset p-6 mt-8 hidden">
                <h3 id="detail-date" class="font-bold mb-4 uppercase opacity-50"></h3>
                <div id="detail-list" class="space-y-4"></div>
            </div>
        </div>
    </div>
</div>

<script>
    const DB_KEY = "Lekovka_V2026_Final";
    const HIST_KEY = "Lekovka_Hist_V2026_Final";
    const daysName = ["Ne","Po","Út","St","Čt","Pá","So"];
    let viewDate = new Date();

    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('sw.js');
    }

    const load = (k) => JSON.parse(localStorage.getItem(k)) || [];
    const save = (k, v) => localStorage.setItem(k, JSON.stringify(v));

    function toggleDarkMode() {
        const dark = document.body.classList.toggle('dark');
        localStorage.setItem('dark-mode', dark);
        document.getElementById('dark-icon').setAttribute('data-icon', dark ? 'lucide:sun' : 'lucide:moon');
    }

    function switchTab(t) {
        document.getElementById('view-today').classList.toggle('hidden', t !== 'today');
        document.getElementById('view-calendar').classList.toggle('hidden', t !== 'calendar');
        if(t === 'calendar') renderCalendar();
    }

    function requestNotif() {
        Notification.requestPermission().then(p => {
            if(p === "granted") alert("Oznámení aktivována!");
        });
    }

    function sendNotification(title, body) {
        if (Notification.permission === "granted") {
            navigator.serviceWorker.ready.then(reg => {
                reg.showNotification(title, {
                    body: body,
                    icon: "https://api.iconify.design/lucide:pill.png?color=%238b8071",
                    vibrate: [300, 100, 300]
                });
            });
        }
    }

    function testNotification() {
        alert("Zavřete aplikaci. Test přijde za 5 sekund.");
        setTimeout(() => sendNotification("Test Lékovky", "Funguje to skvěle!"), 5000);
    }

    function saveMedicine() {
        const name = document.getElementById('f-nazev').value;
        const id = document.getElementById('f-id').value;
        let times = Array.from(document.querySelectorAll(".time-checkbox:checked")).map(c => c.value);
        if(document.getElementById('f-custom-time').value) times.push(document.getElementById('f-custom-time').value);
        
        if(!name || times.length === 0) return alert("Vyplňte jméno a čas!");

        let meds = load(DB_KEY);
        const medObj = { 
            id: id ? parseInt(id) : Date.now(), 
            name, 
            icon: document.querySelector('input[name="f-icon"]:checked').value,
            stock: parseFloat(document.getElementById('f-zasoba').value) || 0, 
            dose: parseFloat(document.getElementById('f-davka').value) || 1, 
            times: [...new Set(times)].sort(),
            mode: 'days', days: [], startDate: new Date().toISOString() 
        };
        
        if(id) meds = meds.map(m => m.id == id ? medObj : m); else meds.push(medObj);
        save(DB_KEY, meds); resetForm(); render();
    }

    function render() {
        const meds = load(DB_KEY); const hist = load(HIST_KEY);
        const todayStr = new Date().toLocaleDateString('cs-CZ');
        const list = document.getElementById('plan-list'); list.innerHTML = "";
        let rem = 0;

        meds.forEach(m => {
            let timesHtml = "";
            m.times.forEach(t => {
                const done = hist.some(h => h.medId === m.id && h.date === todayStr && h.time === t);
                if(!done) rem++;
                timesHtml += `<div class="flex justify-between items-center py-4 border-b border-black/5 last:border-0 ${done?'taken-row':''}">
                    <span class="font-black text-xl">${t}</span>
                    ${done ? '<span class="text-green-600 font-black">HOTOVO</span>' : `<button onclick="take(${m.id},'${t}')" class="neu-btn px-8 text-sm font-black uppercase">VZÍT</button>`}
                </div>`;
            });

            list.innerHTML += `<div class="neu-raised p-8">
                <div class="flex gap-5 items-center mb-6">
                    <div class="neu-inset p-4"><span class="iconify" data-icon="${m.icon}" data-width="32"></span></div>
                    <div class="flex-1"><h3 class="font-black text-2xl">${m.name}</h3><p class="font-bold opacity-50">Sklad: ${m.stock} ks</p></div>
                    <button onclick="editMed(${m.id})" class="text-slate-400 p-2"><span class="iconify" data-icon="lucide:edit-3" data-width="28"></span></button>
                </div>
                <div class="neu-inset p-4 mb-4">${timesHtml}</div>
                <button onclick="deleteMed(${m.id})" class="text-red-300 text-xs font-bold uppercase tracking-widest w-full text-right">Odstranit lék</button>
            </div>`;
        });
        document.getElementById('stat-rem').innerText = rem;
    }

    window.take = (medId, time) => {
        let meds = load(DB_KEY); let m = meds.find(x => x.id === medId);
        m.stock = Math.round((m.stock - m.dose) * 100) / 100;
        let hist = load(HIST_KEY); hist.push({ medId, time, date: new Date().toLocaleDateString('cs-CZ') });
        save(DB_KEY, meds); save(HIST_KEY, hist); render();
    }

    window.editMed = (id) => {
        const m = load(DB_KEY).find(x => x.id === id);
        document.getElementById('f-id').value = m.id;
        document.getElementById('f-nazev').value = m.name;
        document.getElementById('f-zasoba').value = m.stock;
        document.getElementById('f-davka').value = m.dose;
        document.getElementById('btn-cancel').classList.remove('hidden');
        window.scrollTo({top: 0, behavior: 'smooth'});
    }

    function resetForm() {
        document.getElementById('f-id').value = ""; document.getElementById('f-nazev').value = "";
        document.querySelectorAll(".time-checkbox").forEach(c => c.checked = false);
        document.getElementById('btn-cancel').classList.add('hidden');
    }

    window.deleteMed = (id) => confirm("Smazat lék?") && (save(DB_KEY, load(DB_KEY).filter(x => x.id != id)), render());
    
    function renderCalendar() {
        const body = document.getElementById('calendar-body'); body.innerHTML = "";
        const y = viewDate.getFullYear(), m = viewDate.getMonth();
        document.getElementById('month-label').innerText = new Intl.DateTimeFormat('cs-CZ', {month:'long', year:'numeric'}).format(viewDate);
        const first = (new Date(y, m, 1).getDay() + 6) % 7;
        for(let i=0; i < first; i++) body.innerHTML += `<div></div>`;
        for(let d=1; d <= new Date(y, m+1, 0).getDate(); d++) {
            body.innerHTML += `<div class="cal-day neu-btn">${d}</div>`;
        }
    }

    function changeMonth(d) { viewDate.setMonth(viewDate.getMonth() + d); renderCalendar(); }
    
    setInterval(() => {
        const now = new Date();
        document.getElementById('live-clock').innerText = now.toLocaleTimeString('cs-CZ', {hour:'2-digit', minute:'2-digit'});
        if(now.getSeconds() === 0) render(); 
    }, 1000);

    render();
</script>
</body>
</html>
